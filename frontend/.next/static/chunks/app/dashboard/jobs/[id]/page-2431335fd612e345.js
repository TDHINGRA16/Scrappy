(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{3244:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>M});var a=t(8081),r=t(2149),n=t(5160),l=t(6810),i=t(5977),c=t(3940),d=t(9215),o="Progress",[u,x]=(0,c.A)(o),[m,h]=u(o),p=r.forwardRef((e,s)=>{var t,r,n,l;let{__scopeProgress:i,value:c=null,max:o,getValueLabel:u=v,...x}=e;(o||0===o)&&!b(o)&&console.error((t="".concat(o),r="Progress","Invalid prop `max` of value `".concat(t,"` supplied to `").concat(r,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let h=b(o)?o:100;null===c||y(c,h)||console.error((n="".concat(c),l="Progress","Invalid prop `value` of value `".concat(n,"` supplied to `").concat(l,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let p=y(c,h)?c:null,j=N(p)?u(p,h):void 0;return(0,a.jsx)(m,{scope:i,value:p,max:h,children:(0,a.jsx)(d.sG.div,{"aria-valuemax":h,"aria-valuemin":0,"aria-valuenow":N(p)?p:void 0,"aria-valuetext":j,role:"progressbar","data-state":g(p,h),"data-value":null!=p?p:void 0,"data-max":h,...x,ref:s})})});p.displayName=o;var j="ProgressIndicator",f=r.forwardRef((e,s)=>{var t;let{__scopeProgress:r,...n}=e,l=h(j,r);return(0,a.jsx)(d.sG.div,{"data-state":g(l.value,l.max),"data-value":null!==(t=l.value)&&void 0!==t?t:void 0,"data-max":l.max,...n,ref:s})});function v(e,s){return"".concat(Math.round(e/s*100),"%")}function g(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function N(e){return"number"==typeof e}function b(e){return N(e)&&!isNaN(e)&&e>0}function y(e,s){return N(e)&&!isNaN(e)&&e<=s&&e>=0}f.displayName=j;var w=t(7687);let _=r.forwardRef((e,s)=>{let{className:t,value:r,...n}=e;return(0,a.jsx)(p,{ref:s,className:(0,w.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:(0,a.jsx)(f,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});_.displayName=p.displayName;var k=t(6247),S=t(7849),A=t(1018);let E=(0,A.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),C=(0,A.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var B=t(186),R=t(2827),F=t(7363);function M(e){var s,t;let{params:c}=e,d=(0,r.use)(c),[o,u]=(0,r.useState)(null),[x,m]=(0,r.useState)([]),[h,p]=(0,r.useState)([]),[j,f]=(0,r.useState)(!0),[v,g]=(0,r.useState)(""),[N,b]=(0,r.useState)("csv"),y=async()=>{try{let e=localStorage.getItem("token"),s=await fetch("/api/export/jobs/".concat(d.id,"/status"),{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)throw Error("Failed to fetch job status");let t=await s.json();u(t),t.has_results&&w()}catch(e){g(e instanceof Error?e.message:"Failed to fetch job status")}finally{f(!1)}},w=async()=>{try{let e=localStorage.getItem("token"),s=await fetch("/api/export/json/".concat(d.id,"?include_messages=true"),{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)throw Error("Failed to fetch job results");let t=await s.json();m(t.results||[]),p(t.messages||[])}catch(e){g(e instanceof Error?e.message:"Failed to fetch job results")}};(0,r.useEffect)(()=>{y();let e=setInterval(()=>{o&&("pending"===o.status||o.status.includes("processing")||o.status.includes("scraping"))&&y()},5e3);return()=>clearInterval(e)},[d.id]);let A=e=>"completed"===e||"sent"===e?"success":"failed"===e||e.includes("failed")?"destructive":e.includes("processing")||e.includes("scraping")||"pending"===e?"warning":"secondary";return j?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("p",{children:"Loading job details..."})}):v?(0,a.jsxs)(B.Fc,{variant:"destructive",children:[(0,a.jsx)(S.A,{className:"h-4 w-4"}),(0,a.jsx)(B.TN,{children:v})]}):o?(0,a.jsxs)("div",{className:"space-y-6 bg-white min-h-screen p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{height:"50px",width:"300px",marginBottom:"10px"},children:(0,a.jsx)(F.A,{text:"JOB #".concat(o.job_id),flex:!0,alpha:!1,stroke:!1,width:!0,weight:!0,italic:!0,textColor:"#000000",minFontSize:18})}),o.query&&(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:o.query}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["Google Maps"," • ","scrape_only"===o.mode?"Scrape Only":"Scrape & Contact"," • ",(0,R.m)(new Date(o.created_at),{addSuffix:!0})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.E,{variant:A(o.status),children:o.status}),(0,a.jsx)(n.$,{variant:"outline",size:"icon",onClick:y,children:(0,a.jsx)(E,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Job Progress"}),(0,a.jsx)(l.BT,{children:"Current status of your job"})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsx)(_,{value:o?"completed"===o.status?100:"pending"===o.status?5:o.status.includes("processing")?30:o.status.includes("scraping_completed")?70:50:0}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Results"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:o.results_count})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Messages"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:o.messages_count})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sent"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(s=o.message_stats)||void 0===s?void 0:s.sent)||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(t=o.message_stats)||void 0===t?void 0:t.failed)||0})]})]})]})]}),o.has_results&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(k.tU,{defaultValue:"results",children:[(0,a.jsxs)(k.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(k.Xi,{value:"results",children:["Results (",x.length,")"]}),(0,a.jsxs)(k.Xi,{value:"messages",children:["Messages (",h.length,")"]})]}),(0,a.jsx)(k.av,{value:"results",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Scraped Results"}),(0,a.jsx)(l.BT,{children:"Businesses found during scraping"})]}),(0,a.jsx)(l.Wu,{children:0===x.length?(0,a.jsx)("p",{children:"No results found yet."}):(0,a.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,a.jsxs)("div",{className:"border-b pb-4",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2",children:[(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Website:"})," ",e.website?(0,a.jsx)("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:e.website}):"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Email:"})," ",e.email||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Phone:"})," ",e.phone||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Place Type:"})," ",e.place_type||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Reviews:"})," ",e.reviews_count?"".concat(e.reviews_count," (").concat(e.reviews_average,"★)"):"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Opening Hours:"})," ",e.opening_hours||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Store Shopping:"})," ",e.store_shopping||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"In-Store Pickup:"})," ",e.in_store_pickup||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Delivery:"})," ",e.store_delivery||"N/A"]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Source:"})," ",e.source||"N/A"]})]}),e.address&&(0,a.jsxs)("p",{className:"text-sm mt-2",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Address:"})," ",e.address]}),e.introduction&&(0,a.jsxs)("p",{className:"text-sm mt-2",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"About:"})," ",e.introduction]})]},e.id))})})]})}),(0,a.jsx)(k.av,{value:"messages",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Outreach Messages"}),(0,a.jsx)(l.BT,{children:"Messages sent to contacts"})]}),(0,a.jsx)(l.Wu,{children:0===h.length?(0,a.jsx)("p",{children:"No messages found for this job."}):(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,a.jsxs)("div",{className:"border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"font-medium",children:e.recipient}),(0,a.jsx)(i.E,{variant:A(e.status),children:e.status})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["email"===e.contact_method?"Email":"WhatsApp",e.sent_at&&(0,a.jsxs)(a.Fragment,{children:[" • ",(0,R.m)(new Date(e.sent_at),{addSuffix:!0})]})]}),(0,a.jsx)("p",{className:"text-sm mt-2 border-l-2 border-muted pl-2 italic",children:e.message})]},e.id))})})]})})]}),o.can_export&&(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Export Data"}),(0,a.jsx)(l.BT,{children:"Download your results in different formats"})]}),(0,a.jsx)(l.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(n.$,{variant:"csv"===N?"default":"outline",onClick:()=>b("csv"),children:"CSV"}),(0,a.jsx)(n.$,{variant:"excel"===N?"default":"outline",onClick:()=>b("excel"),children:"Excel"}),(0,a.jsx)(n.$,{variant:"json"===N?"default":"outline",onClick:()=>b("json"),children:"JSON"})]})}),(0,a.jsx)(l.wL,{children:(0,a.jsxs)(n.$,{onClick:()=>{let e=localStorage.getItem("token"),s="/api/export/".concat(N,"/").concat(d.id,"?include_messages=true"),t=document.createElement("form");t.method="POST",t.action=s;let a=document.createElement("meta");a.name="authorization",a.content="Bearer ".concat(e),document.head.appendChild(a),document.body.appendChild(t),t.submit(),setTimeout(()=>{document.head.removeChild(a),document.body.removeChild(t)},100)},children:[(0,a.jsx)(C,{className:"mr-2 h-4 w-4"}),"Export as ",N.toUpperCase()]})})]})]})]}):(0,a.jsxs)(B.Fc,{variant:"destructive",children:[(0,a.jsx)(S.A,{className:"h-4 w-4"}),(0,a.jsx)(B.TN,{children:"Job not found"})]})}},5977:(e,s,t)=>{"use strict";t.d(s,{E:()=>i});var a=t(8081);t(2149);var r=t(3484),n=t(7687);let l=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:t}),s),...r})}},8175:(e,s,t)=>{Promise.resolve().then(t.bind(t,3244))}},e=>{var s=s=>e(e.s=s);e.O(0,[741,584,827,266,497,573,358],()=>s(8175)),_N_E=e.O()}]);